<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetSync Web Editor</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="welcome-screen">
        <div class="welcome-container">
            <div class="logo">MetSync</div>
            <h1>Web Editor</h1>
            <p>Create and edit BPM files for your MetSync device</p>
            <div class="welcome-actions">
                <button id="createNewBtn" class="btn btn-primary">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="12" y1="18" x2="12" y2="12"/>
                        <line x1="9" y1="15" x2="15" y2="15"/>
                    </svg>
                    Create New File
                </button>
                <button id="openFileBtn" class="btn btn-secondary">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                        <polyline points="13 2 13 9 20 9"/>
                    </svg>
                    Open BPM File
                </button>
                <input type="file" id="fileInput" accept=".bpm" style="display: none;">
            </div>
        </div>
    </div>

    <!-- Editor Screen -->
    <div id="editorScreen" class="editor-screen" style="display: none;">
        <!-- Header -->
        <header class="editor-header">
            <div class="header-left">
                <div class="logo-small">MetSync</div>
                <span class="separator">|</span>
                <span id="fileName" class="file-name">Untitled.bpm</span>
            </div>
            <div class="header-actions">
                <button id="themeToggleBtn" class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme (Ctrl+T)">ðŸŒ“</button>
                <button id="bookmarksBtn" class="btn btn-small" onclick="toggleBookmarksPanel()" title="Bookmarks (Ctrl+B)">ðŸ“‘</button>
                <button id="exportClickTrackBtn" class="btn btn-small" title="Export Click Track">ðŸŽµ Export Click</button>
                <button id="saveBtn" class="btn btn-small" title="Save (Ctrl+S)">Save</button>
                <button id="downloadBtn" class="btn btn-small">Download</button>
                <button id="closeBtn" class="btn btn-small btn-outline">Close</button>
            </div>
        </header>

        <!-- Preview Panel -->
        <div class="transport-controls">
            <div class="playback-controls">
                <button id="playPauseBtn" class="btn-play" title="Play/Pause (Space)">
                    <svg id="playIcon" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    <svg id="pauseIcon" style="display: none;" viewBox="0 0 24 24">
                        <path d="M6 4h4v16H6zM14 4h4v16h-4z"/>
                    </svg>
                </button>
                <button id="stopBtn" class="btn-stop" title="Stop">
                    <svg viewBox="0 0 24 24">
                        <rect x="6" y="6" width="12" height="12"/>
                    </svg>
                </button>
            </div>

            <div class="metronome-indicator" title="Beat pulse">
                <div id="metronomeOrb" class="metronome-orb"></div>
                <span>Pulse</span>
            </div>

            <div class="cursor-mode">
                <label>Cursor Mode:</label>
                <div class="mode-toggle">
                    <button id="modeClick" class="active">Click</button>
                    <button id="modeFollow">Follow</button>
                </div>
            </div>

            <div class="metronome-toggle">
                <label class="toggle">
                    <input type="checkbox" id="metronomeToggle" checked>
                    <span class="toggle-slider"></span>
                </label>
                <span class="toggle-label">Audio Metronome</span>
            </div>

            <!-- Volume Control - will be added by JS -->
            <div id="volumeControlContainer" class="volume-control-container"></div>
        </div>

        <!-- Timeline Container -->
        <div class="timeline-container">
            <div class="timeline-controls">
                <div class="controls-left">
                    <button id="addEventBtn" class="btn btn-small btn-primary">+ Add Event</button>
                    <div class="zoom-controls">
                        <label>Zoom:</label>
                        <button id="zoomOutBtn" class="btn btn-icon">âˆ’</button>
                        <span id="zoomLevel">100%</span>
                        <button id="zoomInBtn" class="btn btn-icon">+</button>
                    </div>
                </div>
                <div class="preview-panel">
                    <div class="preview-item">
                        <span class="preview-label">Status</span>
                        <span id="previewStatus" class="preview-value status-stopped">STOPPED</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Time</span>
                        <span id="previewTime" class="preview-value">0:00.000</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Measure</span>
                        <span id="previewMeasure" class="preview-value">1</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Beat</span>
                        <span id="previewBeat" class="preview-value">1</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">BPM</span>
                        <span id="previewBPM" class="preview-value">120</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Time Sig</span>
                        <span id="previewTimeSig" class="preview-value">4/4</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Î” Beats</span>
                        <span id="previewDeltaBeats" class="preview-value">â€”</span>
                    </div>
                </div>
            </div>

            <div class="timeline-wrapper">
                <div class="timeline-ruler" id="timelineRuler"></div>
                <div class="timeline-tracks">
                    <div class="track">
                        <div class="track-label">Start/Stop</div>
                        <div class="track-content" id="trackStartStop" data-track="startstop"></div>
                    </div>
                    <div class="track">
                        <div class="track-label">BPM Changes</div>
                        <div class="track-content" id="trackBPM" data-track="bpm"></div>
                    </div>
                    <div class="track">
                        <div class="track-label">Time Signature</div>
                        <div class="track-content" id="trackTimeSig" data-track="timesig"></div>
                    </div>
                </div>
                <div class="timeline-cursor" id="timelineCursor"></div>
                <div class="timeline-status-marker" id="timelineStatusMarker">
                    <span class="marker-label">Î” Beats</span>
                    <span id="markerValue">â€”</span>
                </div>
            </div>
        </div>

        <!-- Event Edit Panel -->
        <div id="eventPanel" class="event-panel" style="display: none;">
            <div class="event-panel-header">
                <h3 id="eventPanelTitle">Add Event</h3>
                <button id="closePanelBtn" class="btn btn-icon">Ã—</button>
            </div>
            <div class="event-panel-content">
                <div class="form-group">
                    <label>Event Type:</label>
                    <select id="eventType" class="form-control">
                        <option value="startstop">Start/Stop Command</option>
                        <option value="bpm">BPM Change</option>
                        <option value="timesig">Time Signature</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Measure:</label>
                    <input type="number" id="eventMeasure" class="form-control" value="1" min="1">
                </div>
                <div class="form-group">
                    <label>Beat:</label>
                    <input type="number" id="eventBeat" class="form-control" value="1" min="1" max="4">
                </div>

                <!-- Start/Stop specific -->
                <div id="startStopOptions" class="event-options">
                    <div class="form-group">
                        <label>Command:</label>
                        <select id="startStopCommand" class="form-control">
                            <option value="start">START</option>
                            <option value="stop">STOP</option>
                        </select>
                    </div>
                </div>

                <!-- BPM specific -->
                <div id="bpmOptions" class="event-options" style="display: none;">
                    <div class="form-group">
                        <label>Change Type:</label>
                        <select id="bpmChangeType" class="form-control">
                            <option value="static">Static (Instant)</option>
                            <option value="gradual">Gradual</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Target BPM:</label>
                        <input type="number" id="bpmValue" class="form-control" value="120" min="1" max="300">
                    </div>
                    <div id="gradualOptions" class="form-group" style="display: none;">
                        <label>Duration (measures):</label>
                        <input type="number" id="bpmDuration" class="form-control" value="4" min="1">
                    </div>
                </div>

                <!-- Time Signature specific -->
                <div id="timeSigOptions" class="event-options" style="display: none;">
                    <div class="form-group">
                        <label>Beats per Measure:</label>
                        <input type="number" id="timeSigBeats" class="form-control" value="4" min="1" max="16">
                    </div>
                    <div class="form-group">
                        <label>Beat Unit:</label>
                        <select id="timeSigUnit" class="form-control">
                            <option value="2">2</option>
                            <option value="4" selected>4</option>
                            <option value="8">8</option>
                            <option value="16">16</option>
                        </select>
                    </div>
                </div>

                <div class="form-actions">
                    <button id="saveEventBtn" class="btn btn-primary">Save Event</button>
                    <button id="deleteEventBtn" class="btn btn-danger" style="display: none;">Delete Event</button>
                    <button id="cancelEventBtn" class="btn btn-outline">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
