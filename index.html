<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>metsync web editor</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%236366f1' width='100' height='100' rx='20'/%3E%3Ctext x='50' y='70' font-size='60' font-weight='bold' text-anchor='middle' fill='white' font-family='system-ui'%3Em%3C/text%3E%3C/svg%3E">
    <link rel="stylesheet                <!-- BPM specific -->
                <div id="bpmOptions" class="event-options" style="display: none;">
                    <div class="form-group">
                        <label>change type:</label>
                        <select id="bpmChangeType" class="form-control">
                            <option value="static">instant</option>
                            <option value="gradual">gradual</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>bpm:</label>les.css"                <!-- Time Signature specific -->
                <div id="timeSigOptions" class="event-options" style="display: none;">
                    <div class="form-group">
                        <label>beats per measure:</label>
                        <input type="number" id="timeSigBeats" class="form-control" value="4" min="1" max="16">
                    </div>
                    <div class="form-group">
                        <label>note value:</label>ink rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="welcome-screen">
        <div class="welcome-container">
            <div class="logo">metsync</div>
            <h1>web editor</h1>
            <p>create and edit bpm files for your metsync device</p>
            <div class="welcome-actions">
                <button id="createNewBtn" class="btn btn-primary">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="12" y1="18" x2="12" y2="12"/>
                        <line x1="9" y1="15" x2="15" y2="15"/>
                    </svg>
                    create new file
                </button>
                <button id="openFileBtn" class="btn btn-secondary">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                        <polyline points="13 2 13 9 20 9"/>
                    </svg>
                    open bpm file
                </button>
                <input type="file" id="fileInput" accept=".bpm" style="display: none;">
            </div>
        </div>
    </div>

    <!-- Editor Screen -->
    <div id="editorScreen" class="editor-screen" style="display: none;">
        <!-- Header -->
        <header class="editor-header">
            <div class="header-left">
                <div class="logo-small">metsync</div>
                <span class="separator">|</span>
                <span id="fileName" class="file-name">Untitled.bpm</span>
            </div>
            <div class="header-actions">
                <button id="themeToggleBtn" class="theme-toggle" onclick="toggleTheme()" title="toggle theme (ctrl+t)">ðŸŒ“</button>
                <button id="bookmarksBtn" class="btn btn-small" onclick="toggleBookmarksPanel()" title="bookmarks (ctrl+b)">ðŸ“‘</button>
                <button id="exportClickTrackBtn" class="btn btn-small" title="export click track">ðŸŽµ export click</button>
                <button id="saveBtn" class="btn btn-small" title="save (ctrl+s)">save</button>
                <button id="downloadBtn" class="btn btn-small">download</button>
                <button id="closeBtn" class="btn btn-small btn-outline">close</button>
            </div>
        </header>

        <!-- Preview Panel -->
        <div class="transport-controls">
            <div class="playback-controls">
                <button id="playPauseBtn" class="btn-play" title="Play/Pause (Space)">
                    <svg id="playIcon" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    <svg id="pauseIcon" style="display: none;" viewBox="0 0 24 24">
                        <path d="M6 4h4v16H6zM14 4h4v16h-4z"/>
                    </svg>
                </button>
                <button id="stopBtn" class="btn-stop" title="Stop">
                    <svg viewBox="0 0 24 24">
                        <rect x="6" y="6" width="12" height="12"/>
                    </svg>
                </button>
            </div>

            <div class="metronome-indicator" title="Beat pulse">
                <div id="metronomeOrb" class="metronome-orb"></div>
                <span>pulse</span>
            </div>

            <div class="cursor-mode">
                <label>cursor mode:</label>
                <div class="mode-toggle">
                    <button id="modeClick" class="active">click</button>
                    <button id="modeFollow">follow</button>
                </div>
            </div>

            <div class="metronome-toggle">
                <label class="toggle">
                    <input type="checkbox" id="metronomeToggle" checked>
                    <span class="toggle-slider"></span>
                </label>
                <span class="toggle-label">audio metronome</span>
            </div>

            <!-- Volume Control - will be added by JS -->
            <div id="volumeControlContainer" class="volume-control-container"></div>
        </div>

        <!-- Timeline Container -->
        <div class="timeline-container">
            <div class="timeline-controls">
                <div class="controls-left">
                    <button id="addEventBtn" class="btn btn-small btn-primary">+ add event</button>
                    <div class="zoom-controls">
                        <label>zoom:</label>
                        <button id="zoomOutBtn" class="btn btn-icon">âˆ’</button>
                        <span id="zoomLevel">100%</span>
                        <button id="zoomInBtn" class="btn btn-icon">+</button>
                    </div>
                </div>
                <div class="preview-panel">
                    <div class="preview-item">
                        <span class="preview-label">status</span>
                        <span id="previewStatus" class="preview-value status-stopped">stopped</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">time</span>
                        <span id="previewTime" class="preview-value">0:00.000</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">measure</span>
                        <span id="previewMeasure" class="preview-value">1</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">beat</span>
                        <span id="previewBeat" class="preview-value">1</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">bpm</span>
                        <span id="previewBPM" class="preview-value">120</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">time sig</span>
                        <span id="previewTimeSig" class="preview-value">4/4</span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Î” beats</span>
                        <span id="previewDeltaBeats" class="preview-value">â€”</span>
                    </div>
                </div>
            </div>

            <div class="timeline-wrapper">
                <div class="timeline-ruler" id="timelineRuler"></div>
                <div class="timeline-tracks">
                    <div class="track">
                        <div class="track-label">start/stop</div>
                        <div class="track-content" id="trackStartStop" data-track="startstop"></div>
                    </div>
                    <div class="track">
                        <div class="track-label">bpm changes</div>
                        <div class="track-content" id="trackBPM" data-track="bpm"></div>
                    </div>
                    <div class="track">
                        <div class="track-label">time signature</div>
                        <div class="track-content" id="trackTimeSig" data-track="timesig"></div>
                    </div>
                </div>
                <div class="timeline-cursor" id="timelineCursor"></div>
                <div class="timeline-status-marker" id="timelineStatusMarker">
                    <span class="marker-label">Î” Beats</span>
                    <span id="markerValue">â€”</span>
                </div>
            </div>
        </div>

        <!-- Event Edit Panel -->
        <div id="eventPanel" class="event-panel" style="display: none;">
            <div class="event-panel-header">
                <h3 id="eventPanelTitle">add event</h3>
                <button id="closePanelBtn" class="btn btn-icon">Ã—</button>
            </div>
            <div class="event-panel-content">
                <div class="form-group">
                    <label>event type:</label>
                    <select id="eventType" class="form-control">
                        <option value="startstop">start/stop command</option>
                        <option value="bpm">bpm change</option>
                        <option value="timesig">time signature</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>measure:</label>
                    <input type="number" id="eventMeasure" class="form-control" value="1" min="1">
                </div>
                <div class="form-group">
                    <label>beat:</label>
                    <input type="number" id="eventBeat" class="form-control" value="1" min="1" max="4">
                </div>

                <!-- Start/Stop specific -->
                <div id="startStopOptions" class="event-options">
                    <div class="form-group">
                        <label>command:</label>
                        <select id="startStopCommand" class="form-control">
                            <option value="start">start</option>
                            <option value="stop">stop</option>
                        </select>
                    </div>
                </div>

                <!-- BPM specific -->
                <div id="bpmOptions" class="event-options" style="display: none;">
                    <div class="form-group">
                        <label>Change Type:</label>
                        <select id="bpmChangeType" class="form-control">
                            <option value="static">Static (Instant)</option>
                            <option value="gradual">Gradual</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Target BPM:</label>
                        <input type="number" id="bpmValue" class="form-control" value="120" min="1" max="300">
                    </div>
                    <div id="gradualOptions" class="form-group" style="display: none;">
                        <label>Duration (measures):</label>
                        <input type="number" id="bpmDuration" class="form-control" value="4" min="1">
                    </div>
                </div>

                <!-- Time Signature specific -->
                <div id="timeSigOptions" class="event-options" style="display: none;">
                    <div class="form-group">
                        <label>Beats per Measure:</label>
                        <input type="number" id="timeSigBeats" class="form-control" value="4" min="1" max="16">
                    </div>
                    <div class="form-group">
                        <label>Beat Unit:</label>
                        <select id="timeSigUnit" class="form-control">
                            <option value="2">2</option>
                            <option value="4" selected>4</option>
                            <option value="8">8</option>
                            <option value="16">16</option>
                        </select>
                    </div>
                </div>

                <div class="form-actions">
                    <button id="saveEventBtn" class="btn btn-primary">Save Event</button>
                    <button id="deleteEventBtn" class="btn btn-danger" style="display: none;">Delete Event</button>
                    <button id="cancelEventBtn" class="btn btn-outline">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
